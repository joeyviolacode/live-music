{% extends "base.html" %}

{% block content %}
{% load crispy_forms_tags %}



<div class="musician-info-area flex justify-between">
    <div class="left pa4">
        <div class="left-top flex">
            <div class="picture">
                <div class="musician-show center">

                    <div class="pb3">
                    <img class="profile-photo br-100" src="{{ musician.full_cover.url }}">
                    </div>
                </div>
            </div>
            <div class="name-location pl4 w-50">

                <h1>{{musician.name}}</h1>
                {% if user.pk is not musician.pk %}
                    <a id="toggle-favorite" data-musician-id = "{{ musician.pk }}" class="no-underline pointer dib grow f3" id='parent-favorite'>
                        {% if user_favorite %}
                            &#9733;
                            {% else %}
                            &#9734;
                        {% endif %}
                    </a>
                {% endif %}
                <p class="">{{musician.bio}}</p>
                {% if musician.pk == user.pk %}
                <div>
                    <a href="{% url 'add-donation' musician_pk=musician.pk %}">Setup Donations</a>
                </div>
                <div>
                    <a href="{% url 'edit-musician' musician_pk=musician.pk %}">Edit profile</a>
                </div>  
                <div>
                    <a href="{% url 'add-event' musician_pk=musician.pk %}">Add an event</a>
                </div>      
                {% endif %}        
            </div>
        </div>

<!-- 
        <div class="left-bottom">
            <p>{{musician.bio}}</p>
        </div> -->
    </div>





    <div class="right flex justify-around calendar w-40">
        <p>Right</p> 
    </div>

</div>



<div class="event-list">
    {%if musician.events.all.count %}
    <h3>{{musician.name}}'s events:</h3>
    {% endif %}
    <div class="flex flex-wrap">
        {% for event in musician.events.all %}
        {% if event.is_upcoming %}
        <a href="{% url 'event' pk=event.pk %}">
            <div class="shadow-3 br3 ma3 event-pane">
                    <div class="image-div flex pa2">
                        <img class="br2" src="{{ event.thumbnail.url }}">
                    </div>
                    <div class="info-div flex flex-column tc">
                        <h4 class="b">
                            {{event.title}}
                        </h4>
                        <p>
                            <a href="{% url 'show-musician' musician_pk=event.owner.user.pk %}">{{event.owner.name}}</a>
                        </p>
                        <p>
                            {{event.date_time}}
                        </p>
                        {% if user == musician.user %}
                        <a href="{% url 'edit-event' event_pk=event.pk %}">Edit this event</a>
                        {% endif %}
                    </div>
            </div>
        </a>
        {% endif %}
        {% endfor %}
    </div>
    {%if musician.events.all.count %}
    <h3>Past events:</h3>
    {% endif %}
    <div class="flex flex-wrap">
        {% for event in musician.events.all %}
        {% if event.is_finished %}
            <div class="shadow-3 br3 ma3 event-pane">
                <a href="{% url 'event' pk=event.pk %}">
                    <div class="image-div flex pa2">
                        <img class="br2" src="{{ event.thumbnail.url }}">
                    </div>
            </a>
                <div class="info-div flex flex-column tc">
                    <h4 class="b">
                        {{event.title}}
                    </h4>
                    <p>
                        <a href="{% url 'show-musician' musician_pk=event.owner.user.pk %}">{{event.owner.name}}</a>
                    </p>
                    <p>
                        {{event.date_time}}
                    </p>
                </div>
            </div>
        {% endif %}
        {% endfor %}

        
<!-- 
        <div>
            <a href="{% url 'add-donation' musician_pk=musician.pk %}">Setup Donations</a><br>
            <a href="{% url 'donation-tutorial' %}">Donation Tutorial</a>
        </div> -->

    </div>
</div>
<!-- Donation Tags -->
<br>
{% if musician.cashapp_name %}
    <p>Cashapp name: {{musician.cashapp_name}}</p>
{% endif %}
{% if musician.paypal_donation_url and not musician.paypal_qr %} 
    <a href="{{musician.paypal_donation_url}}" target="_blank">Paypal link</a><br> 
{% endif %}
{% if musician.cashapp_qr %}
    <img class="" src="{{ musician.cashapp_qr.url }}"><br>
{% endif %}
{% if musician.paypal_donation_url and musician.paypal_qr %}
    <a href="{{musician.paypal_donation_url}}"><img src="{{ musician.paypal_qr.url }}" /></a><br>
{% endif %}
{% if musician.paypal_qr and not musician.paypal_donation_url %}
    <img class="" src="{{ musician.paypal_qr.url }}"><br>
{% endif %}
{% if musician.venmo_qr %}
    <img class="" src="{{ musician.venmo_qr.url }}">
{% endif %}

<!-- comments -->
{% if user.is_authenticated %}
<h2>{{ musician.musician_comments.count }} comments</h2>

<h3>Leave a comment</h3>
<form enctype="multipart/form-data" method="post" style="margin-top: 1.3em;">
    {% csrf_token %}
    {{ comment_form | crispy }}
  
  <button type="submit" class="btn btn-primary  btn-lg">Submit</button>
</form>

{% for comment in musician.musician_comments.all %}

<div class="comments" style="padding: 10px;">
  <p class="font-weight-bold">
    On {{ comment.date_created }}
    <span class=" text-muted font-weight-normal">
      {{ comment.author }} says:
    </span>
  </p>
  {{ comment.message | linebreaks }}
</div>

{% endfor %}
{% endif %}
<script>
    window.addEventListener("load", (e) => {
        const toggleFavoriteLink = document.querySelector("#toggle-favorite")
        toggleFavoriteLink.addEventListener('click', function (e) {
        e.preventDefault()
        const musicianId = toggleFavoriteLink.dataset['musicianId']
        fetch(`/musician/${musicianId}/favorite`, {
            method: 'POST'
        })
        .then(res => res.json())
        .then(data => {
            if (data.favorite) {
                toggleFavoriteLink.innerHTML = '&#9733;'
        } else {
        toggleFavoriteLink.innerHTML = '&#9734;'
        }
        })
    })
    })
    
</script>


{% endblock content %}